<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        ul, #myUL {
          list-style-type: none;
        }

        #myUL {
          margin: 0;
          padding: 0;
        }

        .caret {
          cursor: pointer;
          -webkit-user-select: none; /* Safari 3.1+ */
          -moz-user-select: none; /* Firefox 2+ */
          -ms-user-select: none; /* IE 10+ */
          user-select: none;
        }

        .caret::before {
          content: "\25B6";
          color: black;
          display: inline-block;
          margin-right: 6px;
        }

        .caret-down::before {
          -ms-transform: rotate(90deg); /* IE 9 */
          -webkit-transform: rotate(90deg); /* Safari */
          transform: rotate(90deg);  
        }

        .nested {
          display: none;
        }

        .active {
          display: block;
        }
    </style>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    
    
    <!-- Latest compiled and minified CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>


    <title>Hello, world!</title>
</head>

<body>

  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo">Open modal for @mdo</button>
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@fat">Open modal for @fat</button>
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@getbootstrap">Open modal for @getbootstrap</button>
  
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">New message</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="signup">
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">Recipient:</label>
              <input type="text" class="form-control" id="recipient-name">
            </div>
            <div class="mb-3">
              <label for="message-text" class="col-form-label">Message:</label>
              <textarea class="form-control" id="message-text"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="add_file">Send message</button>
        </div>
      </div>
    </div>
  </div>

        <ul id="myUL">
        </ul>
    
    <script>
        var exampleModal = document.getElementById('exampleModal')
        exampleModal.addEventListener('show.bs.modal', function (event) {
          // Button that triggered the modal
          var button = event.relatedTarget
          // Extract info from data-bs-* attributes
          var recipient = button.getAttribute('data-bs-whatever')
          // If necessary, you could initiate an AJAX request here
          // and then do the updating in a callback.
          //
          // Update the modal's content.
          var modalTitle = exampleModal.querySelector('.modal-title')
          var modalBodyInput = exampleModal.querySelector('.modal-body input')

          modalTitle.textContent = 'New message to ' + recipient
          modalBodyInput.value = recipient
        })
        
        const form  = document.getElementById('signup');
        document.getElementById("add_file").addEventListener("click", function() {
          var input = document.getElementById("message-text").value;
          console.log(input)

          window.location.reload();
        });




        /*
            tree directory view for scripts 
            https://www.w3schools.com/howto/howto_js_treeview.asp
        */
        function toggle_tree_view(){
            var toggler = document.getElementsByClassName("caret");
            var i;

            for (i=0; i < toggler.length; i++) {
              console.log(toggler[i])
              toggler[i].addEventListener("click", function() {
                this.parentElement.querySelector(".nested").classList.toggle("active");
                this.classList.toggle("caret-down");
              });
            }
        }

        const makeRequest = (method, url, data = {}) => {
          const xhr = new XMLHttpRequest();
          return new Promise(resolve => {
            xhr.open(method, url, true);
            xhr.onload = () => resolve({
              status: xhr.status,
              response: xhr.responseText
            });
            xhr.onerror = () => resolve({
              status: xhr.status,
              response: xhr.responseText
            });
            if (method != 'GET') xhr.setRequestHeader('Content-Type', 'application/json');
            data != {} ? xhr.send(JSON.stringify(data)) : xhr.send();
          })
        }


        async function addData(){
            let request = await makeRequest('GET', `/api/script_builder/upload/list/`);
            console.log("status:", request.status)
            console.log("response:", request.response)
            var data = JSON.parse(request.response).dir_list;

            base_url = window.location.origin;
            for(var key in data){
                var tree_ul = ""
                if (data.hasOwnProperty(key)){
                    var value=data[key];
                    // console.log(key,value)
                    var tree_view_list = ""
                    for(j=0; j<value.length; j++){
                        var link = new URL(`scripts/`, base_url);
                        link.searchParams.append('dir_path', key);
                        link.searchParams.append('file_path', value[j]);
                        link = link.href
                        console.log(link)

                        console.log(`<li>${value[j]}</li>`)
                        var tree_view_list = tree_view_list + `<a href="${link}"><li>${value[j]}</li></a>`
                    }  
                }
                tree_ul = `<li>
                              <span class="caret">
                                ${key}
                              </span>
                              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@getbootstrap">Open modal for @getbootstrap</button>
                                <ul class="nested">
                                  ${tree_view_list}
                                </ul>   
                            </li>`
                document.getElementById('myUL').innerHTML += tree_ul
                toggle_tree_view()
                

            }
        }

    window.addEventListener('load', (event) => {
        console.log('page is fully loaded');
        /* 
            https://stackoverflow.com/questions/48969495/in-javascript-how-do-i-should-i-use-async-await-with-xmlhttprequest
        */

        addData()  
    });

    </script>

</body>

</html>